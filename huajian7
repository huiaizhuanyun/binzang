<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‡çˆ±æœåŠ¡è´¹ç”¨è®¡ç®—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --danger-color: #FF3B30;
            --dark: #1D1D1F;
            --gray: #86868B;
            --light-gray: #F2F2F7;
            --white: #FFFFFF;
            --shadow: 0 10px 40px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 60px rgba(0,0,0,0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--dark);
            animation: backgroundShift 20s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes backgroundShift {
            0%, 100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            25% { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
            50% { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
            75% { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        }

        /* èƒŒæ™¯è£…é¥°å…ƒç´  */
        .bg-decoration {
            position: fixed;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 20s infinite ease-in-out;
            pointer-events: none;
            z-index: -1;
        }

        .bg-decoration:nth-child(1) {
            top: -250px;
            left: -250px;
            animation-delay: 0s;
        }

        .bg-decoration:nth-child(2) {
            bottom: -250px;
            right: -250px;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 30px auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: var(--shadow);
            animation: slideUp 0.8s ease-out;
            transition: var(--transition);
        }

        .container:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            animation: fadeInScale 1s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
            position: relative;
            animation: slideInLeft 0.6s ease-out;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }

        h2:hover::after {
            width: 100%;
        }

        h3 {
            font-size: 1.3rem;
            color: var(--dark);
            margin: 25px 0 15px;
            padding: 10px 15px;
            background: var(--light-gray);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        h3::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        h3:hover::before {
            left: 100%;
        }

        h3:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateX(5px);
        }

        .section {
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.2s; }
        .section:nth-child(3) { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            transition: var(--transition);
        }

        input[type="text"],
        input[type="number"],
        input[type="datetime-local"],
        select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 15px;
            border: 2px solid var(--light-gray);
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        input[type="checkbox"]:checked {
            animation: checkPulse 0.3s ease;
        }

        @keyframes checkPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* å½•éŸ³å½•åƒæŒ‰é’®ç»„ */
        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .recording-controls button {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .recording-controls button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .recording-controls button:hover::before {
            width: 300px;
            height: 300px;
        }

        .recording-controls button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 122, 255, 0.3);
        }

        .recording-controls button:active {
            transform: translateY(-1px);
        }

        /* æœåŠ¡é¡¹ç›®æ ·å¼ */
        .service-item {
            padding: 15px;
            margin-bottom: 15px;
            background: var(--light-gray);
            border-radius: 12px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .service-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .service-item:hover::before {
            left: 100%;
        }

        .service-item:hover {
            background: white;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transform: translateX(5px);
        }

        .service-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 0;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: inline-block;
            padding: 16px 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            margin: 10px;
            border: none;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::after {
            width: 400px;
            height: 400px;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.4);
        }

        .btn:active {
            transform: translateY(-1px) scale(1);
        }

        .btn-container {
            text-align: center;
            margin: 40px 0;
        }

        /* æ€»è´¹ç”¨æ˜¾ç¤º */
        .total {
            text-align: right;
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--light-gray), white);
            border-radius: 16px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .total-with-discount {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 20px;
        }

        .total-discounted {
            color: var(--success-color);
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* è´¦å•è¯¦æƒ… */
        .bill {
            margin-top: 50px;
            padding: 30px;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            animation: slideUp 0.8s ease-out;
        }

        .bill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 12px;
            transition: var(--transition);
        }

        .bill-header:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .bill-header h2 {
            margin: 0;
            border: none;
            animation: none;
        }

        .bill-item {
            margin: 20px 0;
            padding: 20px;
            background: var(--light-gray);
            border-radius: 12px;
            transition: var(--transition);
            animation: fadeInUp 0.5s ease-out;
        }

        .bill-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .bill-service {
            margin-left: 20px;
            margin-top: 15px;
        }

        .bill-service p {
            margin: 8px 0;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            transition: var(--transition);
        }

        .bill-service p:hover {
            background: var(--primary-color);
            color: white;
            transform: translateX(5px);
        }

        /* ä»·æ ¼ç¼–è¾‘æ ·å¼ */
        .price-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: var(--transition);
        }

        .price-item:hover {
            background: var(--light-gray);
            transform: translateX(5px);
        }

        .editable-price {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
            transition: var(--transition);
            position: relative;
        }

        .editable-price:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .editable-price::after {
            content: 'âœï¸';
            position: absolute;
            right: -20px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .editable-price:hover::after {
            opacity: 1;
        }

        .price-edit-container {
            display: flex;
            align-items: center;
            margin-left: 15px;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .price-edit-input {
            width: 100px;
            padding: 6px 10px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            font-size: 14px;
        }

        .price-edit-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .price-edit-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        .discounted-price {
            color: var(--success-color);
            font-weight: bold;
            margin-left: 10px;
            animation: highlight 0.5s ease;
        }

        @keyframes highlight {
            0% { background: yellow; }
            100% { background: transparent; }
        }

        .strikethrough {
            text-decoration: line-through;
            color: var(--gray);
            opacity: 0.6;
        }

        /* äºŒç»´ç æ ·å¼ */
        .qrcode-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .qrcode-button {
            padding: 12px 30px;
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
        }

        .qrcode-button:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 122, 255, 0.3);
        }

        .qrcode-button.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
        }

        .qrcode-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
        }

        .qrcode-container > div {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .qrcode-container > div:not(.hidden) {
            animation: zoomIn 0.5s ease;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .qrcode-container img {
            width: 180px;
            height: 180px;
            border-radius: 12px;
            transition: var(--transition);
        }

        .qrcode-container > div:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .qrcode-container > div:hover img {
            transform: scale(1.05);
        }

        .qrcode-container p {
            margin-top: 15px;
            font-size: 16px;
            font-weight: 500;
            color: var(--dark);
        }

        /* å…¶ä»–æ ·å¼ */
        .hidden {
            display: none !important;
        }

        .input-inline {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-right: 20px;
        }

        .input-inline input {
            width: 100px;
            margin-bottom: 0;
        }

        .input-inline label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .note {
            font-size: 14px;
            color: var(--gray);
            font-style: italic;
            margin-top: 5px;
        }

        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: center;
            transition: var(--transition);
        }

        .table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
        }

        .table td {
            background: white;
            border-bottom: 1px solid var(--light-gray);
        }

        .table tr:hover td {
            background: var(--light-gray);
            transform: scale(1.02);
        }

        .fengshui {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            font-size: 1.4rem;
            color: var(--danger-color);
            background: linear-gradient(135deg, #FFE5E5, #FFF0F0);
            border-radius: 16px;
            font-weight: 600;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 59, 48, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 59, 48, 0.5); }
        }

        .service-header {
            cursor: pointer;
            position: relative;
            padding-right: 30px;
        }

        .service-header::after {
            content: 'â–¼';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            transition: var(--transition);
        }

        .service-header.expanded::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .service-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .service-content.show {
            max-height: 1000px;
        }

        .subtotal {
            font-weight: bold;
            margin-top: 15px;
            padding: 10px 15px;
            text-align: right;
            color: var(--success-color);
            background: linear-gradient(135deg, #E8F5E9, #F1F8E9);
            border-radius: 8px;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--light-gray);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 20px;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.4rem;
            }

            .btn {
                width: 100%;
                margin: 10px 0;
            }

            .recording-controls {
                flex-direction: column;
            }

            .recording-controls button {
                width: 100%;
            }

            .qrcode-container {
                flex-direction: column;
            }

            .input-inline {
                display: block;
                margin-bottom: 10px;
            }

            .input-inline input {
                width: 100%;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .container {
                box-shadow: none;
                border: 1px solid #ddd;
            }

            .btn, .recording-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <div class="container">
        <h1>æ±‡çˆ±æœåŠ¡è´¹ç”¨è®¡ç®—</h1>
        
        <div class="recording-controls">
            <button onclick="startRecording('audio')">ğŸ¤ å¼€å§‹å½•éŸ³</button>
            <button onclick="stopRecording('audio')">â¹ åœæ­¢å½•éŸ³</button>
            <button onclick="startRecording('video')">ğŸ“¹ å¼€å§‹å½•åƒ</button>
            <button onclick="stopRecording('video')">â¹ åœæ­¢å½•åƒ</button>
        </div>

        <div class="section">
            <h2>é€è€…åŠå®¶å±ä¿¡æ¯</h2>
            <label>é€è€…å§“åï¼š</label>
            <input type="text" id="deceasedName" required placeholder="è¯·è¾“å…¥é€è€…å§“å">

            <label>èº«ä»½è¯å·ï¼š</label>
            <input type="text" id="idNumber" maxlength="18" required placeholder="è¯·è¾“å…¥18ä½èº«ä»½è¯å·">

            <label>å¹´é¾„ï¼š</label>
            <input type="number" id="age" min="0" placeholder="è‡ªåŠ¨è®¡ç®—æˆ–æ‰‹åŠ¨è¾“å…¥">

            <label>æ€§åˆ«ï¼š</label>
            <input type="text" id="gender" readonly placeholder="è‡ªåŠ¨è¯†åˆ«">

            <label>å®¶åº­ä½å€ï¼š</label>
            <input type="text" id="address" required placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€">

            <label>å®¶å±ç”µè¯ï¼š</label>
            <input type="text" id="familyPhone" required placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
            <p id="phoneLocation" class="note"></p>

            <label>åœæ”¾æ—¶é—´ï¼š</label>
            <input type="datetime-local" id="storageTime" required>

            <label>æ¥æºï¼š</label>
            <select id="source">
                <option value="å…¬è·¯">å…¬è·¯</option>
                <option value="æ€¥æ•‘">æ€¥æ•‘</option>
                <option value="ç—…æˆ¿">ç—…æˆ¿</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>

            <div id="sourceMemo">
                <label>å¤‡å¿˜ä¿¡æ¯ï¼š</label>
                <input type="text" id="sourceMemoInput" placeholder="è¯·è¾“å…¥å¤‡å¿˜ä¿¡æ¯">
            </div>
        </div>

        <div class="section services">
            <h2>æ±‡çˆ±åŸºç¡€æœåŠ¡ï¼ˆå¿…é€‰æœåŠ¡ï¼‰</h2>

            <h3>1. æ¥å°¸æœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label>æ¥è¿è½¦è´¹ï¼š</label>
                    <select id="transportFee" class="service-select" data-category="æ¥å°¸æœåŠ¡">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="600" data-name="å¸‚å†…æ¥è¿">å¸‚å†…æ¥è¿ï¼š600å…ƒ/æ¬¡</option>
                        <option value="1000" data-name="ä¸‹ä¹¡æ¥è¿">ä¸‹ä¹¡æ¥è¿ï¼š1000å…ƒ/æ¬¡</option>
                        <option value="2000" data-name="æ±‡çˆ±å¸‚å†…æ¥è¿">æ±‡çˆ±å¸‚å†…æ¥è¿ï¼š2000å…ƒ/æ¬¡</option>
                        <option value="3000" data-name="æ±‡çˆ±ä¸‹ä¹¡æ¥è¿">æ±‡çˆ±ä¸‹ä¹¡æ¥è¿ï¼š3000å…ƒ/æ¬¡</option>
                    </select>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="æ¥å°¸æœåŠ¡" data-name="å°¸ä½“è¢‹" data-price="260"> å°¸ä½“è¢‹ï¼š260å…ƒ/ä¸ª</label>
                </div>
                <div class="service-item">
                    <label>æ¥å°¸æœåŠ¡è´¹ï¼š</label>
                    <select id="corpseServiceFee" class="service-select" data-category="æ¥å°¸æœåŠ¡">
                        <option value="400" data-name="å¤šä½å¸ˆå‚…" selected>å¤šä½å¸ˆå‚…ï¼š400å…ƒ/æ¬¡</option>
                        <option value="260" data-name="ä¸€ä½å¸ˆå‚…">ä¸€ä½å¸ˆå‚…ï¼š260å…ƒ/æ¬¡</option>
                    </select>
                </div>
                <div class="service-item">
                    <label>ä¸Šæ¥¼æ¬æŠ¬è´¹ï¼š</label>
                    <select id="upstairsFee" class="service-select" data-category="æ¥å°¸æœåŠ¡">
                        <option value="0" data-name="æ— ">æ— </option>
                        <option value="0" data-name="æœ‰æ‹…æ¶ç”µæ¢¯">æœ‰æ‹…æ¶ç”µæ¢¯ï¼šå…è´¹</option>
                        <option value="100" data-name="æ­¥æ¢¯">æ­¥æ¢¯ï¼š100å…ƒ/å±‚</option>
                    </select>
                    <div id="stairsInput" class="hidden">
                        <label>è¯·è¾“å…¥æ¥¼å±‚æ•°ï¼š</label>
                        <input type="number" id="stairsFloors" min="1" placeholder="è¾“å…¥æ¥¼å±‚æ•°">
                    </div>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" id="over20Hours" data-category="æ¥å°¸æœåŠ¡" data-name="æ­»äº¡æ—¶é—´è¶…è¿‡20å°æ—¶" data-price="300"> æ­»äº¡æ—¶é—´è¶…è¿‡20å°æ—¶ï¼šåŠ æ”¶300å…ƒ</label>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" id="decomposition" data-category="æ¥å°¸æœåŠ¡" data-name="è…çƒ‚æƒ…å†µ" data-price="600"> è…çƒ‚æƒ…å†µåŠ æ”¶ï¼š600å…ƒ</label>
                </div>
            </div>

            <h3>2. åœæ”¾ä¸ä¿å­˜æœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label>å†·å†»åœä¿è´¹ï¼š<span class="note">380å…ƒ/å¤©ï¼ˆä¸æ»¡1å¤©ä»¥100å…ƒ/å°æ—¶è®¡ï¼Œ380å…ƒå°é¡¶ï¼‰</span></label>
                    <div class="input-inline">
                        <input type="number" id="freezingDays" min="0" placeholder="å¤©æ•°">
                        <label>å¤©</label>
                    </div>
                    <div class="input-inline">
                        <input type="number" id="freezingHours" min="0" max="24" placeholder="å°æ—¶æ•°">
                        <label>å°æ—¶</label>
                    </div>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="åœæ”¾ä¸ä¿å­˜æœåŠ¡" data-name="ç¯å¢ƒæ¶ˆæ¯’è´¹" data-price="100" checked disabled> ç¯å¢ƒæ¶ˆæ¯’è´¹ï¼š100å…ƒï¼ˆå¿…é€‰ï¼Œä»…è®¡ä¸€æ¬¡ï¼‰</label>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="åœæ”¾ä¸ä¿å­˜æœåŠ¡" data-name="ç¯å¢ƒå«ç”Ÿè´¹" data-price="100" checked disabled> ç¯å¢ƒå«ç”Ÿè´¹ï¼š100å…ƒï¼ˆå¿…é€‰ï¼Œä»…è®¡ä¸€æ¬¡ï¼‰</label>
                </div>
                <div class="service-item">
                    <label>å¤ªç©ºè¢«ï¼š<span class="note">ç”¨äºè¾…åŠ©åˆ¶å†·åŠéœ€è¦æ‹æ‘„CTè€…</span></label>
                    <select id="spaceQuilt" class="service-select" data-category="åœæ”¾ä¸ä¿å­˜æœåŠ¡">
                        <option value="200" data-name="å¤ªç©ºè¢«ï¼ˆ200å…ƒ/å¥—ï¼‰" selected>200å…ƒ/å¥—</option>
                        <option value="100" data-name="å¤ªç©ºè¢«ï¼ˆ100å…ƒ/æ¡ï¼‰">100å…ƒ/æ¡</option>
                    </select>
                    <div id="quiltQuantity" class="hidden">
                        <label>è¯·è¾“å…¥æ¡æ•°ï¼š</label>
                        <input type="number" id="quiltCount" min="0" value="1" placeholder="è¾“å…¥æ¡æ•°">
                    </div>
                </div>
            </div>

            <h3>3. è¾…åŠ©æœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="è¾…åŠ©æœåŠ¡" data-name="å°¸ä½“æ£€éªŒåºŠä½¿ç”¨è´¹" data-price="200"> å°¸ä½“æ£€éªŒåºŠä½¿ç”¨è´¹ï¼š200å…ƒ</label>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="è¾…åŠ©æœåŠ¡" data-name="æ–™ç†è´¹" data-price="200"> æ–™ç†è´¹ï¼ˆååŠ©æŠ¬å°¸ã€æ¸…æ´—ã€å¤„ç†ç­‰ï¼‰ï¼š200å…ƒ/æ¬¡</label>
                </div>
                <div class="service-item">
                    <label><input type="checkbox" class="service" data-category="è¾…åŠ©æœåŠ¡" data-name="CTæœåŠ¡è´¹" data-price="300"> CTæœåŠ¡è´¹ï¼ˆä»…åŒ…æ‹¬CTé¢„çº¦åŠæŠ¬å°¸ååŠ©ï¼Œä¼šè¯Šï¼Œä¸åŒ…å«CTè´¹ï¼‰ï¼š300å…ƒ/æ¬¡</label>
                </div>
            </div>

            <h3 class="service-header">4. å€¼å®ˆæœåŠ¡</h3>
            <div class="service-content">
                <div class="service-item">
                    <label>å€¼å®ˆæ—¶é—´ï¼š</label>
                    <div class="input-inline">
                        <input type="number" id="dayGuardHours" min="0" placeholder="ç™½å¤©å°æ—¶æ•°">
                        <label>ç™½å¤©ï¼ˆ30å…ƒ/å°æ—¶ï¼‰</label>
                    </div>
                    <div class="input-inline">
                        <input type="number" id="nightGuardHours" min="0" placeholder="å¤œé—´å°æ—¶æ•°">
                        <label>å¤œé—´ï¼ˆ50å…ƒ/å°æ—¶ï¼‰</label>
                    </div>
                    <p class="note">æ¯å¤©2å°æ—¶å†…ï¼šå…è´¹</p>
                </div>
            </div>

            <h3>5. å›å®¶æœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label>å•ç¨‹å…¬é‡Œæ•°ï¼š</label>
                    <input type="number" id="homeDistance" min="0" placeholder="è¾“å…¥å…¬é‡Œæ•°">
                    <table class="table">
                        <tr>
                            <th>é‡Œç¨‹ï¼ˆå…¬é‡Œï¼‰</th>
                            <th>ä»·æ ¼ï¼ˆå…ƒï¼‰</th>
                        </tr>
                        <tr>
                            <td>10å…¬é‡Œå†…</td>
                            <td>600</td>
                        </tr>
                        <tr>
                            <td>20å…¬é‡Œå†…</td>
                            <td>700</td>
                        </tr>
                        <tr>
                            <td>30å…¬é‡Œå†…</td>
                            <td>800</td>
                        </tr>
                        <tr>
                            <td>40å…¬é‡Œå†…</td>
                            <td>1000</td>
                        </tr>
                        <tr>
                            <td>50å…¬é‡Œå†…</td>
                            <td>1200</td>
                        </tr>
                        <tr>
                            <td>50-200å…¬é‡Œ</td>
                            <td>12å…ƒ/å…¬é‡Œï¼ˆåŒç¨‹ï¼‰</td>
                        </tr>
                        <tr>
                            <td>200å…¬é‡Œä»¥ä¸Š</td>
                            <td>10å…ƒ/å…¬é‡Œï¼ˆåŒç¨‹ï¼‰</td>
                        </tr>
                    </table>
                    <p class="note">è¶…è¿‡70å…¬é‡Œçš„åŠ æ”¶æŒ‰å•ç¨‹æ¯å…¬é‡Œ0.5å…ƒçš„è·¯æ¡¥è´¹</p>
                </div>
            </div>
        </div>

        <div class="section services">
            <h2>æ±‡çˆ±å…³æ€€æœåŠ¡ï¼ˆå¯é€‰æœåŠ¡ï¼‰</h2>

            <h3>1. ç¼åˆæœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label>åŸºç¡€ç¼åˆï¼š<span class="note">340å…ƒ + 160å…ƒ/å˜ç±³ï¼Œä»·æ ¼10000å…ƒå°é¡¶</span></label>
                    <div class="input-inline">
                        <input type="number" id="sutureLength" min="0" placeholder="å˜ç±³æ•°">
                        <label>å˜ç±³</label>
                    </div>
                    <label><input type="checkbox" id="filling"> éœ€å¡«å……</label>
                    <label><input type="checkbox" id="skullImplant"> é¢…éª¨æ¤å…¥</label>
                </div>
            </div>

            <h3>2. æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡</h3>
            <div>
                <div class="service-item">
                    <label>è¯·é€‰æ‹©æœåŠ¡ç±»å‹ï¼š</label>
                    <select id="makeupService">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="å¥—é¤1">å…¨éƒ¨æœåŠ¡åŠå…¬å…±ç”¨å“ï¼š2860å…ƒ</option>
                        <option value="å¥—é¤2">å…¨éƒ¨æœåŠ¡åŠä¸€æ¬¡æ€§åŒ–å¦†å“ï¼š3560å…ƒ</option>
                        <option value="å¥—é¤3">å…¨éƒ¨æœåŠ¡åŠå…¨æ–°å·¥å…·å’Œå…¨æ–°é«˜æ¡£åŒ–å¦†å“ï¼š3960å…ƒ</option>
                        <option value="å•é€‰æœåŠ¡">å•é€‰æœåŠ¡</option>
                    </select>
                    <p class="note">å¥—é¤åŒ…å«ï¼šæ´—å‘æˆ–ä¿®å‘ã€æ¸…æ´å£é¼»è€³ã€å‰ªæŒ‡ç”²ã€ä¿®é¼»æ¯›æˆ–åˆ®èƒ¡å­ã€æ²æµ´éœ²æ´—æ¾¡ã€æ“¦å¹²ã€ä¸¤ä½å¸ˆçˆ¶è½»æŸ”ç©¿è¡£ã€åŒ–å¦†</p>
                </div>
                <div id="singleServices" class="hidden">
                    <div class="service-item">
                        <label><input type="checkbox" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡" data-name="ç©¿è¡£æ£€éªŒåºŠä½¿ç”¨è´¹" data-price="100"> ç©¿è¡£æ£€éªŒåºŠä½¿ç”¨è´¹ï¼š100å…ƒ</label>
                    </div>
                    <div class="service-item">
                        <label><input type="checkbox" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡" data-name="å†°æ£ºç™½å¸ƒã€æ¬æŠ¬ç™½å¸ƒã€æ¯›å·¾" data-price="100"> å†°æ£ºç™½å¸ƒã€æ¬æŠ¬ç™½å¸ƒã€æ¯›å·¾ï¼ˆ10-20æ¡ï¼‰ï¼š100å…ƒ</label>
                    </div>
                    <div class="service-item">
                        <label><input type="checkbox" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡" data-name="æ´—å‘æˆ–ä¿®å‘" data-price="200"> æ´—å‘æˆ–ä¿®å‘ï¼š200å…ƒ</label>
                    </div>
                    <div class="service-item">
                        <label><input type="checkbox" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡" data-name="æ¸…æ´å¹¶å°é—­å£é¼»è€³ã€ä¿®å‰ªæ¯›å‘ç­‰" data-price="300"> æ¸…æ´å¹¶å°é—­å£é¼»è€³ã€ä¿®å‰ªæ¯›å‘ç­‰ï¼š300å…ƒ</label>
                    </div>
                    <div class="service-item">
                        <label><input type="checkbox" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡" data-name="æ²æµ´éœ²æ´—æ¾¡" data-price="300"> æ²æµ´éœ²æ´—æ¾¡ï¼š300å…ƒ</label>
                    </div>
                    <div class="service-item">
                        <label>æ“¦å¹²ç©¿è¡£ï¼š</label>
                        <select id="dressingService" class="service-select" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="800" data-name="ä¸€ä½å¸ˆå‚…">ä¸€ä½å¸ˆå‚…ï¼š800å…ƒ</option>
                            <option value="1500" data-name="å¤šä½å¸ˆå‚…æˆ–å¥³å¸ˆå‚…">å¤šä½å¸ˆå‚…æˆ–å¥³å¸ˆå‚…ï¼š1500å…ƒ</option>
                        </select>
                    </div>
                    <div class="service-item">
                        <label>åŒ–å¦†æœåŠ¡ï¼š</label>
                        <select id="makeupOption" class="service-select" data-category="æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="600" data-name="åŒ–å¦†æœåŠ¡ï¼ˆå…¬å…±ç”¨å“ï¼‰">å…¬å…±ç”¨å“ï¼š600å…ƒ</option>
                            <option value="1200" data-name="åŒ–å¦†æœåŠ¡ï¼ˆé«˜æ¡£åŒ–å¦†å“ï¼‰">é«˜æ¡£åŒ–å¦†å“ï¼š1200å…ƒ</option>
                        </select>
                    </div>
                </div>
            </div>

            <h3>3. é¢å¤–ç”¨å“é‡‘é¢</h3>
            <div>
                <div class="service-item">
                    <label>è¯·è¾“å…¥é‡‘é¢ï¼š</label>
                    <input type="number" id="additionalAmount" min="0" placeholder="è¾“å…¥é‡‘é¢">
                </div>
            </div>
        </div>

        <div class="btn-container">
            <button class="btn" onclick="calculateTotal()">ğŸ’° è®¡ç®—æ€»è´¹ç”¨</button>
            <button class="btn" onclick="showFengshui()">ğŸ”® ä½ä¿å®¶åº­</button>
        </div>

        <div class="total" id="totalAmount">
            <div class="total-with-discount">
                <span id="originalTotal">æ€»è´¹ç”¨ï¼š0å…ƒ</span>
                <span id="discountedTotal" class="total-discounted hidden"></span>
            </div>
        </div>
        <div class="fengshui hidden" id="fengshuiPrice"></div>

        <div class="bill" id="billDetails" style="display:none;">
            <div class="bill-header" onclick="toggleBillDetails()">
                <h2>ç‰¹æ®Šé€è€…è´¹ç”¨æ¸…å•</h2>
                <span class="edit-mode-info">ç‚¹å‡»é‡‘é¢å¯ç¼–è¾‘</span>
            </div>
            <div id="billContent"></div>
            <div class="qrcode-buttons">
                <button class="qrcode-button active" onclick="showQRCode('unionpay')">é“¶è”</button>
                <button class="qrcode-button" onclick="showQRCode('wechat')">å¾®ä¿¡</button>
                <button class="qrcode-button" onclick="showQRCode('alipay')">æ”¯ä»˜å®</button>
            </div>
            <div class="qrcode-container">
                <div id="qrcode-unionpay">
                    <img src="qrcode_unionpay.jpg" alt="é“¶è”æ”¶æ¬¾ç ">
                    <p>é“¶è”æ”¶æ¬¾ç </p>
                </div>
                <div id="qrcode-wechat" class="hidden">
                    <img src="qrcode_wechat.jpg" alt="å¾®ä¿¡æ”¶æ¬¾ç ">
                    <p>å¾®ä¿¡æ”¶æ¬¾ç </p>
                </div>
                <div id="qrcode-alipay" class="hidden">
                    <img src="qrcode_alipay.jpg" alt="æ”¯ä»˜å®æ”¶æ¬¾ç ">
                    <p>æ”¯ä»˜å®æ”¶æ¬¾ç </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let chunks = [];
        let recordingType;
        let calculatedTotal = 0;
        let originalTotal = 0;
        let editedPrices = {};
        let billData = {};

        // é¡µé¢åŠ è½½åŠ¨ç”»
        window.addEventListener('load', function() {
            document.querySelectorAll('.section').forEach((section, index) => {
                setTimeout(() => {
                    section.style.opacity = '1';
                }, index * 100);
            });
        });

        // å¹³æ»‘æ»šåŠ¨
        function smoothScroll(target) {
            const element = typeof target === 'string' ? document.querySelector(target) : target;
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        function startRecording(mode) {
            recordingType = mode;
            const constraints = mode === 'audio' ? { audio: true } : { audio: true, video: true };
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const button = event.target;
            button.style.animation = 'pulse 1s infinite';
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.start();
                    chunks = [];
                    mediaRecorder.ondataavailable = e => chunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(chunks, { type: mode === 'audio' ? 'audio/webm' : 'video/webm' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = mode + '_' + new Date().toISOString() + '.webm';
                        a.click();
                    };
                })
                .catch(error => {
                    console.error('Error starting recording:', error);
                    alert('æ— æ³•å¯åŠ¨å½•åˆ¶ï¼Œè¯·æ£€æŸ¥è®¾å¤‡æƒé™');
                });
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                // åœæ­¢åŠ¨ç”»
                document.querySelectorAll('.recording-controls button').forEach(btn => {
                    btn.style.animation = '';
                });
            }
        }

        // è‡ªåŠ¨ç”Ÿæˆå¹´é¾„å’Œæ€§åˆ«
        document.getElementById('idNumber').addEventListener('input', function() {
            var id = this.value;
            var gender = '';

            if (id.length === 15 || id.length === 18) {
                // è·å–æ€§åˆ«
                var genderDigit = id.length === 18 ? id.charAt(16) : id.charAt(14);
                gender = parseInt(genderDigit) % 2 === 1 ? 'ç”·' : 'å¥³';
                document.getElementById('gender').value = gender;

                // è·å–å‡ºç”Ÿæ—¥æœŸå¹¶è®¡ç®—å¹´é¾„
                var birthYear = id.length === 18 ? id.substr(6, 4) : '19' + id.substr(6, 2);
                var birthMonth = id.length === 18 ? id.substr(10, 2) : id.substr(8, 2);
                var birthDay = id.length === 18 ? id.substr(12, 2) : id.substr(10, 2);
                var birthDate = new Date(birthYear, birthMonth - 1, birthDay);
                var today = new Date();
                var age = today.getFullYear() - birthDate.getFullYear();
                var monthDiff = today.getMonth() - birthDate.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                // ä»…åœ¨å¹´é¾„å­—æ®µä¸ºç©ºæˆ–æœªè¢«æ‰‹åŠ¨ä¿®æ”¹æ—¶æ›´æ–°
                if (!document.getElementById('age').dataset.manuallyChanged) {
                    document.getElementById('age').value = age;
                }
            }
        });

        // æ ‡è®°å¹´é¾„å­—æ®µæ˜¯å¦è¢«æ‰‹åŠ¨ä¿®æ”¹
        document.getElementById('age').addEventListener('input', function() {
            this.dataset.manuallyChanged = true;
        });

        // æ ¹æ®å®¶å±ç”µè¯è·å–å½’å±åœ°
        document.getElementById('familyPhone').addEventListener('blur', function() {
            var phone = this.value;
            if (phone.length >= 7) {
                // è¿™é‡Œå¯ä»¥è°ƒç”¨å®é™…çš„API
                document.getElementById('phoneLocation').innerText = 'å½’å±åœ°ï¼šæŸ¥è¯¢ä¸­...';
                setTimeout(() => {
                    document.getElementById('phoneLocation').innerText = 'å½’å±åœ°ï¼šä¸­å›½å¤§é™†';
                }, 1000);
            }
        });

        // ä¸Šæ¥¼æ¬æŠ¬è´¹æ˜¾ç¤ºæ¥¼å±‚è¾“å…¥
        document.getElementById('upstairsFee').addEventListener('change', function() {
            if (this.value === '100') {
                document.getElementById('stairsInput').classList.remove('hidden');
            } else {
                document.getElementById('stairsInput').classList.add('hidden');
            }
        });

        // å¤ªç©ºè¢«æ•°é‡è¾“å…¥
        document.getElementById('spaceQuilt').addEventListener('change', function() {
            if (this.value === '100') {
                document.getElementById('quiltQuantity').classList.remove('hidden');
            } else {
                document.getElementById('quiltQuantity').classList.add('hidden');
            }
        });

        // åŒ–å¦†æœåŠ¡é€‰æ‹©
        document.getElementById('makeupService').addEventListener('change', function() {
            if (this.value === 'å•é€‰æœåŠ¡') {
                document.getElementById('singleServices').classList.remove('hidden');
            } else {
                document.getElementById('singleServices').classList.add('hidden');
            }
        });

        // æœåŠ¡æ ‡é¢˜ç‚¹å‡»å±•å¼€å†…å®¹ï¼ˆæ”¹è¿›ç‰ˆï¼‰
        document.querySelectorAll('.service-header').forEach(function(header) {
            header.addEventListener('click', function() {
                var content = this.nextElementSibling;
                this.classList.toggle('expanded');
                content.classList.toggle('show');
            });
        });

        // è‡ªåŠ¨è®¡ç®—å†·å†»åœä¿è´¹æ—¶é—´
        document.getElementById('storageTime').addEventListener('change', function() {
            var storageTime = new Date(this.value);
            var now = new Date();
            var diff = now - storageTime;
            if (diff > 0) {
                var days = Math.floor(diff / (1000 * 60 * 60 * 24));
                var hours = Math.ceil((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById('freezingDays').value = days;
                document.getElementById('freezingHours').value = hours;
            }
        });

        // æ˜¾ç¤ºæŒ‡å®šäºŒç»´ç 
        function showQRCode(type) {
            document.getElementById('qrcode-unionpay').classList.add('hidden');
            document.getElementById('qrcode-wechat').classList.add('hidden');
            document.getElementById('qrcode-alipay').classList.add('hidden');
            document.getElementById('qrcode-' + type).classList.remove('hidden');

            document.querySelectorAll('.qrcode-button').forEach(function(button) {
                button.classList.remove('active');
            });
            document.querySelector('.qrcode-button[onclick="showQRCode(\'' + type + '\')"]').classList.add('active');
        }

        // åˆ‡æ¢è´¹ç”¨æ¸…å•æ˜¾ç¤º/éšè—
        function toggleBillDetails() {
            var billContent = document.getElementById('billContent');
            if (billContent.style.display === 'none') {
                billContent.style.display = 'block';
                billContent.style.animation = 'fadeInUp 0.5s ease';
            } else {
                billContent.style.display = 'none';
            }
        }

        // è®¡ç®—æ€»è´¹ç”¨
        function calculateTotal() {
            calculatedTotal = 0;
            billData = {};

            // æ¥å°¸æœåŠ¡è´¹é€‰æ‹©
            var transportFee = document.getElementById('transportFee');
            if (transportFee.value) {
                var price = parseFloat(transportFee.value);
                var name = transportFee.options[transportFee.selectedIndex].getAttribute('data-name');
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'æ¥è¿è½¦è´¹ - ' + name, price: price});
                calculatedTotal += price;
            }

            // å…¶ä»–æ¥å°¸æœåŠ¡
            var services = document.querySelectorAll('.service:checked:not(:disabled)');
            services.forEach(function(service) {
                var price = parseFloat(service.getAttribute('data-price'));
                var category = service.getAttribute('data-category');
                var name = service.getAttribute('data-name');
                if (!billData[category]) {
                    billData[category] = [];
                }
                billData[category].push({name: name, price: price});
                calculatedTotal += price;
            });

            // æ¥å°¸æœåŠ¡è´¹é»˜è®¤å¤šä½å¸ˆå‚…
            var corpseServiceFee = document.getElementById('corpseServiceFee');
            if (corpseServiceFee.value) {
                var price = parseFloat(corpseServiceFee.value);
                var name = corpseServiceFee.options[corpseServiceFee.selectedIndex].getAttribute('data-name');
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'æ¥å°¸æœåŠ¡è´¹ - ' + name, price: price});
                calculatedTotal += price;
            }

            // ä¸Šæ¥¼æ¬æŠ¬è´¹
            var upstairsFee = document.getElementById('upstairsFee');
            if (upstairsFee.value === '100') {
                var floors = parseInt(document.getElementById('stairsFloors').value) || 0;
                var price = floors * 100;
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'ä¸Šæ¥¼æ¬æŠ¬è´¹ï¼ˆæ­¥æ¢¯ ' + floors + ' å±‚ï¼‰', price: price});
                calculatedTotal += price;
            } else if (upstairsFee.value === '0' && upstairsFee.options[upstairsFee.selectedIndex].getAttribute('data-name') === 'æœ‰æ‹…æ¶ç”µæ¢¯') {
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'ä¸Šæ¥¼æ¬æŠ¬è´¹ï¼ˆæœ‰æ‹…æ¶ç”µæ¢¯ï¼‰', price: 0});
            }

            // æ­»äº¡æ—¶é—´è¶…è¿‡20å°æ—¶
            if (document.getElementById('over20Hours').checked) {
                var price = parseFloat(document.getElementById('over20Hours').getAttribute('data-price'));
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'æ­»äº¡æ—¶é—´è¶…è¿‡20å°æ—¶', price: price});
                calculatedTotal += price;
            }

            // è…çƒ‚æƒ…å†µåŠ æ”¶
            if (document.getElementById('decomposition').checked) {
                var price = parseFloat(document.getElementById('decomposition').getAttribute('data-price'));
                if (!billData['æ¥å°¸æœåŠ¡']) {
                    billData['æ¥å°¸æœåŠ¡'] = [];
                }
                billData['æ¥å°¸æœåŠ¡'].push({name: 'è…çƒ‚æƒ…å†µåŠ æ”¶', price: price});
                calculatedTotal += price;
            }

            // å†·å†»åœä¿è´¹
            var freezingDays = parseFloat(document.getElementById('freezingDays').value) || 0;
            var freezingHours = parseFloat(document.getElementById('freezingHours').value) || 0;
            var freezingFee = 0;

            if (freezingDays > 0) {
                freezingFee += freezingDays * 380;
            }

            if (freezingHours > 0) {
                var hourlyFee = freezingHours * 100;
                hourlyFee = hourlyFee > 380 ? 380 : hourlyFee;
                freezingFee += hourlyFee;
            }

            if (freezingFee > 0) {
                if (!billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡']) {
                    billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'] = [];
                }
                billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'].push({name: 'å†·å†»åœä¿è´¹', price: freezingFee});
                calculatedTotal += freezingFee;
            }

            // å¿…é€‰çš„ç¯å¢ƒæ¶ˆæ¯’è´¹å’Œç¯å¢ƒå«ç”Ÿè´¹
            var mandatoryServices = document.querySelectorAll('.service:checked:disabled');
            mandatoryServices.forEach(function(service) {
                var price = parseFloat(service.getAttribute('data-price'));
                var category = service.getAttribute('data-category');
                var name = service.getAttribute('data-name');
                if (!billData[category]) {
                    billData[category] = [];
                }
                billData[category].push({name: name, price: price});
                calculatedTotal += price;
            });

            // å¤ªç©ºè¢«
            var spaceQuilt = document.getElementById('spaceQuilt');
            if (spaceQuilt.value) {
                var price = parseFloat(spaceQuilt.value);
                var name = spaceQuilt.options[spaceQuilt.selectedIndex].getAttribute('data-name');
                if (spaceQuilt.value === '100') {
                    var count = parseInt(document.getElementById('quiltCount').value) || 0;
                    price *= count;
                    name += ' x ' + count + 'æ¡';
                }
                if (!billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡']) {
                    billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'] = [];
                }
                billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'].push({name: name, price: price});
                calculatedTotal += price;
            } else {
                var price = 200;
                var name = 'å¤ªç©ºè¢«ï¼ˆ200å…ƒ/å¥—ï¼‰';
                if (!billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡']) {
                    billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'] = [];
                }
                billData['åœæ”¾ä¸ä¿å­˜æœåŠ¡'].push({name: name, price: price});
                calculatedTotal += price;
            }

            // å€¼å®ˆæœåŠ¡
            var dayGuardHours = parseFloat(document.getElementById('dayGuardHours').value) || 0;
            var nightGuardHours = parseFloat(document.getElementById('nightGuardHours').value) || 0;
            var guardFee = 0;

            var totalGuardHours = dayGuardHours + nightGuardHours;
            if (totalGuardHours > 2) {
                var dayFee = dayGuardHours * 30;
                var nightFee = nightGuardHours * 50;
                guardFee = dayFee + nightFee;
                if (!billData['å€¼å®ˆæœåŠ¡']) {
                    billData['å€¼å®ˆæœåŠ¡'] = [];
                }
                if (dayGuardHours > 0) {
                    billData['å€¼å®ˆæœåŠ¡'].push({name: 'ç™½å¤©å€¼å®ˆ ' + dayGuardHours + ' å°æ—¶', price: dayFee});
                }
                if (nightGuardHours > 0) {
                    billData['å€¼å®ˆæœåŠ¡'].push({name: 'å¤œé—´å€¼å®ˆ ' + nightGuardHours + ' å°æ—¶', price: nightFee});
                }
                calculatedTotal += guardFee;
            }

            // å›å®¶æœåŠ¡
            var homeDistance = parseFloat(document.getElementById('homeDistance').value) || 0;
            var homeFee = 0;
            var roadFee = 0;
            var homeName = '';
            if (homeDistance > 0) {
                if (homeDistance <= 10) {
                    homeFee = 600;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ10å…¬é‡Œå†…ï¼‰';
                } else if (homeDistance <= 20) {
                    homeFee = 700;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ20å…¬é‡Œå†…ï¼‰';
                } else if (homeDistance <= 30) {
                    homeFee = 800;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ30å…¬é‡Œå†…ï¼‰';
                } else if (homeDistance <= 40) {
                    homeFee = 1000;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ40å…¬é‡Œå†…ï¼‰';
                } else if (homeDistance <= 50) {
                    homeFee = 1200;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ50å…¬é‡Œå†…ï¼‰';
                } else if (homeDistance <= 200) {
                    homeFee = homeDistance * 2 * 12;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ' + homeDistance + 'å…¬é‡Œï¼Œ50-200å…¬é‡Œï¼‰';
                } else {
                    homeFee = homeDistance * 2 * 10;
                    homeName = 'å›å®¶æœåŠ¡ï¼ˆ' + homeDistance + 'å…¬é‡Œï¼Œ200å…¬é‡Œä»¥ä¸Šï¼‰';
                }
                if (homeDistance > 70) {
                    roadFee = homeDistance * 0.5;
                    homeName += 'ï¼Œè·¯æ¡¥è´¹ï¼š' + roadFee.toFixed(2) + 'å…ƒ';
                }
                if (!billData['å›å®¶æœåŠ¡']) {
                    billData['å›å®¶æœåŠ¡'] = [];
                }
                billData['å›å®¶æœåŠ¡'].push({name: homeName, price: homeFee + roadFee});
                calculatedTotal += homeFee + roadFee;
            }

            // ç¼åˆæœåŠ¡
            var sutureLength = parseFloat(document.getElementById('sutureLength').value) || 0;
            var sutureFee = 0;
            var sutureMultiplier = 1;
            if (document.getElementById('filling').checked || document.getElementById('skullImplant').checked) {
                sutureMultiplier = 2;
            }
            if (sutureLength > 0) {
                sutureFee = (340 + 160 * sutureLength) * sutureMultiplier;
                sutureFee = sutureFee > 10000 ? 10000 : sutureFee;
                var sutureName = 'ç¼åˆæœåŠ¡';
                if (document.getElementById('filling').checked) {
                    sutureName += 'ï¼ˆéœ€å¡«å……ï¼‰';
                }
                if (document.getElementById('skullImplant').checked) {
                    sutureName += 'ï¼ˆé¢…éª¨æ¤å…¥ï¼‰';
                }
                if (!billData['ç¼åˆæœåŠ¡']) {
                    billData['ç¼åˆæœåŠ¡'] = [];
                }
                billData['ç¼åˆæœåŠ¡'].push({name: sutureName, price: sutureFee});
                calculatedTotal += sutureFee;
            }

            // æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡
            var makeupService = document.getElementById('makeupService').value;
            if (makeupService) {
                if (makeupService.startsWith('å¥—é¤')) {
                    var price = 0;
                    var name = '';
                    if (makeupService === 'å¥—é¤1') {
                        price = 2860;
                        name = 'æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡ - å¥—é¤1';
                    } else if (makeupService === 'å¥—é¤2') {
                        price = 3560;
                        name = 'æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡ - å¥—é¤2';
                    } else if (makeupService === 'å¥—é¤3') {
                        price = 3960;
                        name = 'æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡ - å¥—é¤3';
                    }
                    if (!billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡']) {
                        billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'] = [];
                    }
                    billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'].push({name: name, price: price});
                    calculatedTotal += price;
                } else if (makeupService === 'å•é€‰æœåŠ¡') {
                    var singleServices = document.querySelectorAll('#singleServices input[type="checkbox"]:checked');
                    singleServices.forEach(function(service) {
                        var price = parseFloat(service.getAttribute('data-price'));
                        var category = service.getAttribute('data-category');
                        var name = service.getAttribute('data-name');
                        if (!billData[category]) {
                            billData[category] = [];
                        }
                        billData[category].push({name: name, price: price});
                        calculatedTotal += price;
                    });

                    var dressingService = document.getElementById('dressingService');
                    if (dressingService.value) {
                        var price = parseFloat(dressingService.value);
                        var name = dressingService.options[dressingService.selectedIndex].getAttribute('data-name');
                        if (!billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡']) {
                            billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'] = [];
                        }
                        billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'].push({name: 'æ“¦å¹²ç©¿è¡£ - ' + name, price: price});
                        calculatedTotal += price;
                    }

                    var makeupOption = document.getElementById('makeupOption');
                    if (makeupOption.value) {
                        var price = parseFloat(makeupOption.value);
                        var name = makeupOption.options[makeupOption.selectedIndex].getAttribute('data-name');
                        if (!billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡']) {
                            billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'] = [];
                        }
                        billData['æ•´æ´ç©¿è¡£åŒ–å¦†æœåŠ¡'].push({name: name, price: price});
                        calculatedTotal += price;
                    }
                }
            }

            // é¢å¤–ç”¨å“é‡‘é¢
            var additionalAmount = parseFloat(document.getElementById('additionalAmount').value) || 0;
            if (additionalAmount > 0) {
                if (!billData['é¢å¤–ç”¨å“é‡‘é¢']) {
                    billData['é¢å¤–ç”¨å“é‡‘é¢'] = [];
                }
                billData['é¢å¤–ç”¨å“é‡‘é¢'].push({name: 'é¢å¤–ç”¨å“é‡‘é¢', price: additionalAmount});
                calculatedTotal += additionalAmount;
            }

            // ä¿å­˜åŸå§‹æ€»è´¹ç”¨
            originalTotal = calculatedTotal;
            
            // æ˜¾ç¤ºæ€»è´¹ç”¨
            updateTotalDisplay();
            
            // éšè—é£æ°´ä»·
            document.getElementById('fengshuiPrice').classList.add('hidden');

            // æ˜¾ç¤ºè´¹ç”¨æ¸…å•
            var billDetails = document.getElementById('billDetails');
            billDetails.style.display = 'block';
            renderBillContent();

            // é»˜è®¤æ˜¾ç¤ºé“¶è”äºŒç»´ç 
            showQRCode('unionpay');

            // å¹³æ»‘æ»šåŠ¨åˆ°è´¦å•
            smoothScroll('#billDetails');
        }
        
        // æ¸²æŸ“è´¦å•å†…å®¹
        function renderBillContent() {
            var billContent = document.getElementById('billContent');
            billContent.innerHTML = '';
            billContent.style.display = 'block';

            for (var category in billData) {
                var categoryDiv = document.createElement('div');
                categoryDiv.className = 'bill-item';
                var categoryTitle = document.createElement('h3');
                categoryTitle.innerText = category;
                categoryDiv.appendChild(categoryTitle);

                var servicesDiv = document.createElement('div');
                servicesDiv.className = 'bill-service';

                var categorySum = 0;
                billData[category].forEach(function(item, index) {
                    // ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦
                    var itemId = category + '_' + index;
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¾‘åçš„ä»·æ ¼
                    var finalPrice = editedPrices[itemId] !== undefined ? editedPrices[itemId] : item.price;
                    
                    var serviceP = document.createElement('div');
                    serviceP.className = 'price-item';
                    
                    // åˆ›å»ºä»·æ ¼æ˜¾ç¤ºåŒºåŸŸ
                    var priceDisplay = document.createElement('span');
                    priceDisplay.className = 'original-price';
                    
                    if (editedPrices[itemId] !== undefined) {
                        // å¦‚æœæœ‰ç¼–è¾‘åçš„ä»·æ ¼ï¼Œæ˜¾ç¤ºåˆ’æ‰çš„åŸä»·å’Œç¼–è¾‘åçš„ä»·æ ¼
                        priceDisplay.innerHTML = item.name + 'ï¼š<span class="strikethrough">' + 
                            (Math.round(item.price) === item.price ? item.price : item.price.toFixed(2)) + 
                            'å…ƒ</span> <span class="discounted-price editable-price" onclick="showPriceEditInput(\'' + itemId + '\', \'' + item.name + '\', ' + item.price + ', ' + finalPrice + ', this.parentNode.parentNode)">' + 
                            (Math.round(finalPrice) === finalPrice ? finalPrice : finalPrice.toFixed(2)) + 'å…ƒ</span>';
                    } else {
                        // å¦‚æœæ²¡æœ‰ç¼–è¾‘ï¼Œæ˜¾ç¤ºåŸä»·
                        priceDisplay.innerHTML = item.name + 'ï¼š<span class="editable-price" onclick="showPriceEditInput(\'' + itemId + '\', \'' + item.name + '\', ' + item.price + ', ' + item.price + ', this.parentNode.parentNode)">' + 
                            (Math.round(item.price) === item.price ? item.price : item.price.toFixed(2)) + 'å…ƒ</span>';
                    }
                    
                    serviceP.appendChild(priceDisplay);
                    
                    servicesDiv.appendChild(serviceP);
                    categorySum += finalPrice;
                });

                var subtotalP = document.createElement('p');
                subtotalP.className = 'subtotal';
                subtotalP.innerText = 'å°è®¡ï¼š' + (Math.round(categorySum) === categorySum ? categorySum : categorySum.toFixed(2)) + 'å…ƒ';
                servicesDiv.appendChild(subtotalP);

                categoryDiv.appendChild(servicesDiv);
                billContent.appendChild(categoryDiv);
            }
        }
        
        // æ›´æ–°æ€»è´¹ç”¨æ˜¾ç¤º
        function updateTotalDisplay() {
            var discountedTotal = originalTotal;
            
            // è®¡ç®—ç¼–è¾‘åçš„æ€»è´¹ç”¨
            for (var key in editedPrices) {
                var categoryIndex = key.split('_');
                var category = categoryIndex[0];
                var index = parseInt(categoryIndex[1]);
                
                // å‡å»åŸä»·ï¼ŒåŠ ä¸Šç¼–è¾‘åçš„ä»·æ ¼
                discountedTotal = discountedTotal - billData[category][index].price + editedPrices[key];
            }
            
            // æ˜¾ç¤ºæ€»è´¹ç”¨
            if (Object.keys(editedPrices).length > 0) {
                document.getElementById('originalTotal').innerHTML = '<span class="strikethrough">æ€»è´¹ç”¨ï¼š' + 
                    (Math.round(originalTotal) === originalTotal ? originalTotal : originalTotal.toFixed(2)) + 'å…ƒ</span>';
                document.getElementById('discountedTotal').innerText = 'ä¼˜æƒ ä»·ï¼š' + 
                    (Math.round(discountedTotal) === discountedTotal ? discountedTotal : discountedTotal.toFixed(2)) + 'å…ƒ';
                document.getElementById('discountedTotal').classList.remove('hidden');
            } else {
                document.getElementById('originalTotal').innerText = 'æ€»è´¹ç”¨ï¼š' + 
                    (Math.round(originalTotal) === originalTotal ? originalTotal : originalTotal.toFixed(2)) + 'å…ƒ';
                document.getElementById('discountedTotal').classList.add('hidden');
            }
        }
        
        // æ˜¾ç¤ºä»·æ ¼ç¼–è¾‘è¾“å…¥æ¡†
        function showPriceEditInput(itemId, itemName, originalPrice, currentPrice, parentElement) {
            // ç§»é™¤å¯èƒ½å·²å­˜åœ¨çš„ç¼–è¾‘æ¡†
            var existingEdit = document.getElementById('price-edit-' + itemId);
            if (existingEdit) {
                existingEdit.remove();
            }
            
            // åˆ›å»ºç¼–è¾‘å®¹å™¨
            var editContainer = document.createElement('div');
            editContainer.id = 'price-edit-' + itemId;
            editContainer.className = 'price-edit-container';
            
            // åˆ›å»ºè¾“å…¥æ¡†
            var input = document.createElement('input');
            input.type = 'number';
            input.value = currentPrice;
            input.min = 0;
            input.step = 0.01;
            input.className = 'price-edit-input';
            
            // åˆ›å»ºç¡®è®¤æŒ‰é’®
            var confirmBtn = document.createElement('button');
            confirmBtn.innerHTML = 'ç¡®è®¤';
            confirmBtn.className = 'price-edit-btn';
            confirmBtn.onclick = function() {
                var newPrice = parseFloat(input.value);
                if (!isNaN(newPrice) && newPrice >= 0) {
                    // ä¿å­˜ç¼–è¾‘åçš„ä»·æ ¼
                    editedPrices[itemId] = newPrice;
                    
                    // æ›´æ–°æ˜¾ç¤º
                    updatePriceDisplay(itemId, itemName, originalPrice, newPrice, parentElement);
                    
                    // é‡æ–°è®¡ç®—æ€»è´¹ç”¨
                    updateTotalDisplay();
                    
                    // ç§»é™¤ç¼–è¾‘æ¡†
                    editContainer.remove();
                }
            };
            
            // åˆ›å»ºå–æ¶ˆæŒ‰é’®
            var cancelBtn = document.createElement('button');
            cancelBtn.innerHTML = 'å–æ¶ˆ';
            cancelBtn.className = 'price-edit-btn';
            cancelBtn.onclick = function() {
                editContainer.remove();
            };
            
            // æ·»åŠ åˆ°å®¹å™¨
            editContainer.appendChild(input);
            editContainer.appendChild(confirmBtn);
            editContainer.appendChild(cancelBtn);
            
            // æ·»åŠ åˆ°çˆ¶å…ƒç´ 
            parentElement.appendChild(editContainer);
            
            // èšç„¦è¾“å…¥æ¡†
            input.focus();
        }
        
        // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
        function updatePriceDisplay(itemId, itemName, originalPrice, newPrice, parentElement) {
            // æ›´æ–°ä»·æ ¼æ˜¾ç¤ºåŒºåŸŸ
            var priceDisplay = parentElement.querySelector('.original-price');
            
            if (newPrice !== originalPrice) {
                priceDisplay.innerHTML = itemName + 'ï¼š<span class="strikethrough">' + 
                    (Math.round(originalPrice) === originalPrice ? originalPrice : originalPrice.toFixed(2)) + 
                    'å…ƒ</span> <span class="discounted-price editable-price" onclick="showPriceEditInput(\'' + itemId + '\', \'' + itemName + '\', ' + originalPrice + ', ' + newPrice + ', this.parentNode.parentNode)">' + 
                    (Math.round(newPrice) === newPrice ? newPrice : newPrice.toFixed(2)) + 'å…ƒ</span>';
            } else {
                priceDisplay.innerHTML = itemName + 'ï¼š<span class="editable-price" onclick="showPriceEditInput(\'' + itemId + '\', \'' + itemName + '\', ' + originalPrice + ', ' + originalPrice + ', this.parentNode.parentNode)">' + 
                    (Math.round(originalPrice) === originalPrice ? originalPrice : originalPrice.toFixed(2)) + 'å…ƒ</span>';
                
                // å¦‚æœä»·æ ¼æ¢å¤åŸä»·ï¼Œä»ç¼–è¾‘è®°å½•ä¸­åˆ é™¤
                delete editedPrices[itemId];
            }
            
            // é‡æ–°æ¸²æŸ“è´¦å•å†…å®¹ä»¥ç¡®ä¿æ‰€æœ‰ç¼–è¾‘åçš„ä»·æ ¼éƒ½å¯å†æ¬¡ç¼–è¾‘
            renderBillContent();
        }

        function showFengshui() {
            if (calculatedTotal === 0) {
                alert('è¯·å…ˆè®¡ç®—æ€»è´¹ç”¨');
                return;
            }
            var fengshuiPrice = calculateFengshuiPrice(calculatedTotal);
            var fengshuiDiv = document.getElementById('fengshuiPrice');
            if (fengshuiPrice) {
                fengshuiDiv.innerText = 'é£æ°´ä»·ï¼š' + fengshuiPrice.price + 'å…ƒï¼ˆ' + fengshuiPrice.explanation + 'ï¼‰';
            } else {
                var reducedPrice = calculatedTotal - 103;
                fengshuiDiv.innerText = 'é£æ°´ä»·ï¼š' + reducedPrice + 'å…ƒï¼ˆäº”è¡Œç›¸ç”Ÿï¼Œç¥æ„¿é€è€…è½¬ç”Ÿé¡ºåˆ©ï¼Œå‰ç¥¥å¹³å®‰ï¼‰';
            }
            fengshuiDiv.classList.remove('hidden');
            smoothScroll('#fengshuiPrice');
        }

        // è®¡ç®—é£æ°´ä»·
        function calculateFengshuiPrice(total) {
            var min = total - 300 > 0 ? total - 300 : 0;
            for (var price = total; price >= min; price--) {
                var priceStr = String(Math.floor(price));
                if (priceStr.length !== 4) continue;
                var num1 = parseInt(priceStr.charAt(0));
                var num2 = parseInt(priceStr.charAt(1));
                var num3 = parseInt(priceStr.charAt(2));
                var num4 = parseInt(priceStr.charAt(3));
                var element1 = getElement(num1);
                var element2 = getElement(num2);
                var element3 = getElement(num3);
                var element4 = getElement(num4);
                if (element1 && element2 && element3 && element4) {
                    if (isGenerating(element1, element2) && isGenerating(element2, element3) && isGenerating(element3, element4)) {
                        var explanation = num1 + element1 + 'ç”Ÿ' + num2 + element2 + 'ï¼Œ' + num2 + element2 + 'ç”Ÿ' + num3 + element3 + 'ï¼Œ' + num3 + element3 + 'ç”Ÿ' + num4 + element4 + 'ï¼Œäº”è¡Œæµè½¬ï¼Œç¥æ„¿é€è€…è½¬ä¸–é¡ºåˆ©ï¼Œå¹¸ç¦å®‰åº·';
                        return {price: price, explanation: explanation};
                    }
                }
            }
            return null;
        }

        // è·å–æ•°å­—å¯¹åº”çš„äº”è¡Œ
        function getElement(num) {
            var elements = {
                1: 'æ°´',
                6: 'æ°´',
                2: 'ç«',
                7: 'ç«',
                3: 'æœ¨',
                8: 'æœ¨',
                4: 'é‡‘',
                9: 'é‡‘',
                5: 'åœŸ',
                0: 'åœŸ'
            };
            return elements[num];
        }

        // åˆ¤æ–­äº”è¡Œæ˜¯å¦ç›¸ç”Ÿ
        function isGenerating(element1, element2) {
            var generating = {
                'é‡‘': 'æ°´',
                'æ°´': 'æœ¨',
                'æœ¨': 'ç«',
                'ç«': 'åœŸ',
                'åœŸ': 'é‡‘'
            };
            return generating[element1] === element2;
        }

        // æ·»åŠ è¾“å…¥æ¡†èšç„¦æ•ˆæœ
        document.querySelectorAll('input, select').forEach(function(element) {
            element.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.02)';
            });
            element.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        });
    </script>
</body>
</html>
